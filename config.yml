queries:
  informix_replication_lag:
    db: sysmaster
    metrics:
      informix_replication_lag_last_update_seconds:
        type: counter
        help: Timestamp of last lag update
      informix_replication_lag_lagtime_seconds:
        type: gauge
        help: Replication lag in seconds
    sql: |
          SELECT
            "informix_replication_lag_last_update_seconds", "secondary", lt_secondary, lt_time_last_update, "*",
            "informix_replication_lag_lagtime_seconds", "secondary, lt_secondary, lt_lagtime_1, "*"
          FROM
            sysha_lagtime

  informix_disk_activity:
    db: sysmaster
    metrics:
      informix_read_pages_total:
        type: counter
        help: Total number of pages read
      informix_write_pages_total:
        type: counter
        help: Total number of pages written
      informix_read_seconds_total:
        type: counter
        help: Total time taken for reads
      informix_write_seconds_total:
        type: counter
        help: Total time taken for writes
    sql: |
          SELECT
            "informix_read_pages_total", "chunk", chknum, pagesread, "*",
            "informix_write_pages_total", "chunk", chknum, pageswritten, "*",
            "informix_read_seconds_total", "chunk", chknum, readtime, "*",
            "informix_write_seconds_total", "chunk", chknum, writetime, "*"
          FROM
            syschktab c,
            sysdbstab d
          WHERE
            c.dbsnum = d.dbsnum
          ORDER BY 3

  informix_disk_space:
    db: sysmaster
    metrics:
      informix_dbspace_bytes:
        type: gauge
        help: DB space size
    sql: |
          SELECT
            "informix_dbspace_bytes", "dbspace", TRIM(name), "state", "used", SUM(chksize) - SUM(nfree), "*",
            "informix_dbspace_bytes", "dbspace", TRIM(name), "state", "free", SUM(nfree), "*"
          FROM
            sysdbspaces d,
            syschunks c
          WHERE
            d.dbsnum = c.dbsnum
          GROUP BY 3, 10
          ORDER BY 3

  informix_configuration:
    db: sysmaster
    metrics:
      informix_buffers_allocated:
        type: gauge
        help: number of buffers allocated
    sql: |
          SELECT
            "informix_buffers_allocated", "bufsize", bufsize, nbuffs, "*"
          FROM
            sysbufpool
          ORDER BY 3

  informix_profile:
    db: sysmaster
    metrics:
      informix_sequential_scans_total:
        type: counter
        help: Total sequential scans
      informix_sorts_total:
        type: counter
        help: Total sorts
      informix_memory_sorts_total:
        type: counter
        help: Total memory sorts
      informix_disk_sorts_total:
        type: counter
        help: Total disk sorts
      informix_max_sorts_space_bytes:
        type: gauge
        help: Max sorts space
      informix_buffer_transaction_commits_total:
        type: counter
        help: Total transaction commits
      informix_buffer_waits_total:
        type: counter
        help: Total buffer waits
      informix_checkpoints_total:
        type: counter
        help: Total check points
      informix_lock_requests_total:
        type: counter
        help: Total lock requests
      informix_lock_waits_total:
        type: counter
        help: Total lock waits
      informix_dead_locks_total:
        type: counter
        help: Total dead locks
      informix_foreground_writes_total:
        type: counter
        help: Total foreground writes
      informix_least_recently_used_writes:
        type: counter
        help: Least recently used (LRU) writes
      informix_chunk_writes_total:
        type: counter
        help: Total chunk writes
      informix_disk_reads_total:
        type: counter
        help: Total disk reads
      informix_buffer_reads_total:
        type: counter
        help: Total buffer reads
      informix_disk_writes_total:
        type: counter
        help: Total disk writes
      informix_buffer_writes_total:
        type: counter
        help: Total buffer writes
      informix_latch_waits_total:
        type: counter
        help: Total latch waits
    sql: |
          SELECT "informix_sequential_scans_total", value, "*"
          FROM sysprofile
          WHERE name = "seqscans"
          UNION
          SELECT "informix_sorts_total", value, "*"
          FROM sysprofile
          WHERE name = "totalsorts"
          UNION
          SELECT "informix_memory_sorts_total", value, "*"
          FROM sysprofile
          WHERE name = "memsorts"
          UNION
          SELECT "informix_disk_sorts_total", value, "*"
          FROM sysprofile
          WHERE name = "disksorts"
          UNION
          SELECT "informix_max_sorts_space_bytes", value, "*"
          FROM sysprofile
          WHERE name = "maxsortspace"
          UNION
          SELECT "informix_buffer_transaction_commits_total", value, "*"
          FROM sysprofile
          WHERE name = "iscommits"
          UNION
          SELECT "informix_buffer_waits_total", value, "*"
          FROM sysprofile
          WHERE name = "buffwts"
          UNION
          SELECT "informix_checkpoints_total", value, "*"
          FROM sysprofile
          WHERE name = "ckptwts"
          UNION
          SELECT "informix_lock_requests_total", value, "*"
          FROM sysprofile
          WHERE name = "lockreqs"
          UNION
          SELECT "informix_lock_waits_total", value, "*"
          FROM sysprofile
          WHERE name = "lockwts"
          UNION
          SELECT "informix_dead_locks_total", value, "*"
          FROM sysprofile
          WHERE name = "deadlks"
          UNION
          SELECT "informix_foreground_writes_total", value, "*"
          FROM sysprofile
          WHERE name = "fgwrites"
          UNION
          SELECT "informix_least_recently_used_writes_total", value, "*"
          FROM sysprofile
          WHERE name = "lruwrites"
          UNION
          SELECT "informix_chunk_writes_total", value, "*"
          FROM sysprofile
          WHERE name = "chunkwrites"
          UNION
          SELECT "informix_disk_reads_total", value, "*"
          FROM sysprofile
          WHERE name = "dskreads"
          UNION
          SELECT "informix_buffer_reads_total", value, "*"
          FROM sysprofile
          WHERE name = "bufreads"
          UNION
          SELECT "informix_disk_writes_total", value, "*"
          FROM sysprofile
          WHERE name = "dskwrites"
          UNION
          SELECT "informix_buffer_writes_total", value, "*"
          FROM sysprofile
          WHERE name = "bufwrites"
          UNION
          SELECT "informix_latch_waits_total", value, "*"
          FROM sysprofile
          WHERE name = "latchwts"
          ORDER BY 1

  system_buffer_pool:
    db: sysmaster
    metrics:
      informix_buffer_pool_disk_reads_pages_total:
        type: counter
        help: Total buffer pool disk reads
      informix_buffer_pool_page_reads_pages_total:
        type: counter
        help: Total buffer pool page reads
      informix_buffer_pool_page_reads_pages_total:
        type: counter
        help: Total buffer pool buffer reads
      informix_buffer_pool_disk_writes_pages_total:
        type: counter
        help: Total buffer pool disk writes
      informix_buffer_pool_page_writes_pages_total:
        type: counter
        help: Total buffer pool page writes
      informix_buffer_pool_buffer_waits_pages_total:
        type: counter
        help: Total buffer pool buffer waits
      informix_buffer_pool_chunk_writes_pages_total:
        type: counter
        help: Total buffer pool chunk writes
      informix_buffer_pool_page_size_bytes:
        type: gauge
        help: Buffer pool page size
    sql: |
          SELECT
            "informix_buffer_pool_disk_reads_total", "buffersize", bufsize, dskreads, "*",
            "informix_buffer_pool_page_reads_total", "buffersize", bufsize, pagreads, "*",
            "informix_buffer_pool_buffer_reads_total", "buffersize", bufsize, bufreads, "*",
            "informix_buffer_pool_disk_writes_total", "buffersize", bufsize, dskwrites, "*",
            "informix_buffer_pool_page_writes_total", "buffersize", bufsize, pagwrites, "*",
            "informix_buffer_pool_buffer_writes_total", "buffersize", bufsize, bufwrites, "*",
            "informix_buffer_pool_buffer_waits_total", "buffersize", bufsize, bufwaits, "*",
            "informix_buffer_pool_buffer_overflows_total", "buffersize", bufsize, bufwaits, "*"
          FROM sysbufpool

  system_locks:
    db: sysmaster
    metrics:
      informix_locks:
        type: gauge
        help: Informix locks
    sql: |
          SELECT "informix_locks", "waiter", "0",
            (SELECT COUNT(*)
              FROM syslocks
              WHERE waiter IS NULL
                AND dbsname != 'sysmaster'
                AND tabname != 'sysdatabases'), "*"
          FROM sysdual
          UNION ALL
          SELECT "informix_locks", "waiter", "1",
            (SELECT COUNT(*)
              FROM syslocks
              WHERE waiter IS NOT NULL
                AND dbsname != 'sysmaster'
                AND tabname != 'sysdatabases'), "*"
          FROM sysdual
          ORDER BY 1, 3

  virtual_segment_profile:
    db: sysmaster
    metrics:
      informix_virtual_segment_profile_segments:
        type: gauge
        help: Profile segments
      informix_virtual_segment_profile_virtual_used_bytes:
        type: gauge
        help: Virtual used bytes
      informix_virtual_segment_profile_vp_cache_bytes:
        type: gauge
        help: Virtual cached bytes
      informix_virtual_segment_profile_total_pool_size_bytes:
        type: gauge
        help: Virtual total pool size
      informix_virtual_segment_profile_dictpool_pool_bytes:
        type: gauge
        help: dictpool pool size
      informix_virtual_segment_profile_global_pool_bytes:
        type: gauge
        help: global pool size
      informix_virtual_segment_profile_mt_pool_bytes:
        type: gauge
        help: mt pool size
      informix_virtual_segment_profile_rsam_pool_bytes:
        type: gauge
        help: rsam pool size
      informix_virtual_segment_profile_aio_pool_bytes:
        type: gauge
        help: aio pool size
      informix_virtual_segment_profile_dstpool_pool_bytes:
        type: gauge
        help: dstpool pool size
      informix_virtual_segment_profile_procpool_pool_bytes:
        type: gauge
        help: procpool pool size
    sql: |
          SELECT "informix_virtual_segment_profile_segments", COUNT(*), "*"
          FROM sysseglst
          WHERE seg_class = 2
          UNION
          SELECT "informix_virtual_segment_profile_virtual_used_bytes", SUM(seg_blkused) * 4096, "*"
          FROM sysseglst
          WHERE seg_class = 2
          UNION
          SELECT "informix_virtual_segment_profile_vp_cache_bytes", SUM(vp_cache_size) * 4096, "*"
          FROM sysvplst
          UNION
          SELECT "informix_virtual_segment_profile_total_pool_size_bytes", SUM(po_usedamt), "*"
          FROM syspools
          WHERE po_class = 2
          UNION
          SELECT "informix_virtual_segment_profile_" || TRIM(po_name) || "_pool_bytes", SUM(po_usedamt), "*"
          FROM syspools
          WHERE po_class = 2
            AND po_name IN ("dictpool", "global", "mt", "rsam", "aio", "dstpool", "procpool")
          GROUP BY 1
          ORDER BY 1

  virtual_processor_details:
    db: sysmaster
    metrics:
      informix_virtual_processor_details_idle:
        type: gauge
        help: Idle details
      informix_virtual_processor_details_ready:
        type: gauge
        help: Ready details
      informix_virtual_processor_details_semops:
        type: gauge
        help: Semops details
      informix_virtual_processor_details_busy_waits:
        type: gauge
        help: Busy waits details
      informix_virtual_processor_details_spins:
        type: gauge
        help: Spins details
    sql: |
          SELECT
            "informix_virtual_processor_details_idle", "class", classname, COUNT(*) - SUM(num_ready), "*",
            "informix_virtual_processor_details_ready", "class", classname, SUM(num_ready), "*",
            "informix_virtual_processor_details_semops", "class", classname, SUM(total_semops), "*",
            "informix_virtual_processor_details_busy_waits", "class", classname, SUM(total_busy_wts), "*",
            "informix_virtual_processor_details_spins", "class", classname, SUM(total_spins), "*"
          FROM sysvplst
          GROUP BY 3
          ORDER BY 3, 1

  virtual_processor_activity:
    db: sysmaster
    metrics:
      informix_virtual_processor_activity_cpu:
        type: gauge
        help: Virtual CPU activity
    sql: |
          SELECT
            "informix_virtual_processor_activity_cpu", "state", "user", "class", class, SUM(usercpu), "*",
            "informix_virtual_processor_activity_cpu", "state", "system", "class", class, SUM(syscpu), "*"
          FROM sysvpprof
          GROUP BY 5
          ORDER BY 5, 3

  informix_table_statistics:
    db: sysmaster
    metrics:
      informix_table_statistics_partition_number:
        type: gauge
        help: Table partition number
      informix_table_statistics_row_size_bytes:
        type: gauge
        help: Table row size
      informix_table_statistics_columns:
        type: gauge
        help: Table number of columns
      informix_table_statistics_indexes:
        type: gauge
        help: Table number of indexes
      informix_table_statistics_extents:
        type: counter
        help: Table number of extents
      informix_table_statistics_page_size_bytes:
        type: gauge
        help: Table page size
      informix_table_statistics_pages:
        type: counter
        help: Table number of pages
      informix_table_statistics_used_pages:
        type: gauge
        help: Table number of used pages
      informix_table_statistics_data_pages:
        type: gauge
        help: Table number of data pages
      informix_table_statistics_free_pages:
        type: gauge
        help: Table number of free pages
      informix_table_statistics_rows:
        type: gauge
        help: Table number of rows
      informix_table_statistics_rows_per_page:
        type: gauge
        help: Table number of rows per page
      informix_table_statistics_free_rows:
        type: gauge
        help: Table number of free rows
      informix_table_statistics_created_seconds:
        type: untyped
        help: Table creation date
    sql: |
          SELECT
            "informix_table_statistics_partition_number", "database", a.dbsname, "table", a.tabname, a.partnum, "*",
            "informix_table_statistics_row_size_bytes", "database", a.dbsname, "table", a.tabname, b.ti_rowsize, "*",
            "informix_table_statistics_columns", "database", a.dbsname, "table", a.tabname, b.ti_ncols, "*",
            "informix_table_statistics_indexes", "database", a.dbsname, "table", a.tabname, b.ti_nkeys, "*",
            "informix_table_statistics_extents", "database", a.dbsname, "table", a.tabname, b.ti_nextns, "*",
            "informix_table_statistics_page_size_bytes", "database", a.dbsname, "table", a.tabname, b.ti_pagesize, "*",
            "informix_table_statistics_pages", "database", a.dbsname, "table", a.tabname, b.ti_nptotal, "*",
            "informix_table_statistics_used_pages", "database", a.dbsname, "table", a.tabname, b.ti_npused, "*",
            "informix_table_statistics_data_pages", "database", a.dbsname, "table", a.tabname, b.ti_npdata, "*",
            "informix_table_statistics_free_pages", "database", a.dbsname, "table", a.tabname, b.ti_nptotal - b.ti_npused, "*",
            "informix_table_statistics_rows", "database", a.dbsname, "table", a.tabname, b.ti_nrows, "*",
            "informix_table_statistics_rows_per_page", "database", a.dbsname, "table", a.tabname,
            CASE WHEN
              b.ti_rowsize > 0
            THEN
              TRUNC((b.ti_pagesize - 24) / b.ti_rowsize)
            ELSE
              0
            END CASE, "*",
            "informix_table_statistics_free_rows", "database", a.dbsname, "table", a.tabname,
            CASE WHEN
              b.ti_rowsize > 0
            THEN
              TRUNC((b.ti_pagesize - 24) / b.ti_rowsize) * (b.ti_nptotal - b.ti_npused)
            ELSE
              0
            END CASE, "*",
            "informix_table_statistics_created_seconds", "database", a.dbsname, "table", a.tabname, b.ti_created, "*"
          FROM
            systabnames a,
            systabinfo b
          WHERE b.ti_partnum = a.partnum
            AND a.dbsname NOT IN ("sysmaster", "sysuser", "sysutils", "sysadmin", "sbspace", "system", "sysha", "syssbspace2k_01")
            AND b.ti_npdata > 0 -- remove partitions with no data pages
            AND a.tabname NOT MATCHES "sys*"

  informix_table_operations:
    db: sysmaster
    metrics:
      informix_table_operations_lock_requests_total:
        type: counter
        help: Table number of lock requests
      informix_table_operations_lock_waits_total:
        type: counter
        help: Table number of lock waits
      informix_table_operations_deadlocks_total:
        type: counter
        help: Table number of deadlocks
      informix_table_operations_deadlock_timeouts_total:
        type: counter
        help: Table number of deadlock timeouts
      informix_table_operations_reads_total:
        type: counter
        help: Table number of reads
      informix_table_operations_writes_total:
        type: counter
        help: Table number of writes
      informix_table_operations_rewrites_total:
        type: counter
        help: Table number of rewrites
      informix_table_operations_deletes_total:
        type: counter
        help: Table number of deletes
      informix_table_operations_buffer_reads_total:
        type: counter
        help: Table number of buffer reads
      informix_table_operations_buffer_writes_total:
        type: counter
        help: Table number of buffer writes
      informix_table_operations_sequential_scans_total:
        type: counter
        help: Table number of sequential scans
      informix_table_operations_page_reads_total:
        type: counter
        help: Table number of page reads
      informix_table_operations_page_writes_total:
        type: counter
        help: Table number of page writes
    sql: |
          SELECT
            "informix_table_operations_lock_requests_total", "database", dbsname, "table", tabname, lockreqs, "*",
            "informix_table_operations_lock_waits_total", "database", dbsname, "table", tabname, lockwts, "*",
            "informix_table_operations_deadlocks_total", "database", dbsname, "table", tabname, deadlks, "*",
            "informix_table_operations_deadlock_timeouts_total", "database", dbsname, "table", tabname, lktouts, "*",
            "informix_table_operations_reads_total", "database", dbsname, "table", tabname, isreads, "*",
            "informix_table_operations_writes_total", "database", dbsname, "table", tabname, iswrites, "*",
            "informix_table_operations_rewrites_total", "database", dbsname, "table", tabname, isrewrites, "*",
            "informix_table_operations_deletes_total", "database", dbsname, "table", tabname, isdeletes, "*",
            "informix_table_operations_buffer_reads_total", "database", dbsname, "table", tabname, bufreads, "*",
            "informix_table_operations_buffer_writes_total", "database", dbsname, "table", tabname, bufwrites, "*",
            "informix_table_operations_sequential_scans_total", "database", dbsname, "table", tabname, seqscans, "*",
            "informix_table_operations_page_reads_total", "database", dbsname, "table", tabname, pagreads, "*",
            "informix_table_operations_page_writes_total", "database", dbsname, "table", tabname, pagwrites, "*"
          FROM
            systabinfo b,
            sysptprof c
          WHERE b.ti_partnum = c.partnum
            AND dbsname NOT IN ("sysmaster", "sysuser", "sysutils", "sysadmin", "sbspace", "system", "sysha", "syssbspace2k_01")
            AND tabname NOT MATCHES "sys*"
            AND b.ti_npdata > 0

  informix_uptime:
    db: sysmaster
    metrics:
      informix_uptime_curtime_seconds:
        type: counter
        help: Informix DB current time
      informix_uptime_boottime_seconds:
        type: counter
        help: Last Informix Engine Boot time
      informix_uptime_pfclrtime_seconds:
        type: counter
        help: Last time onstat -z was executed
    sql: |
          SELECT
            "informix_uptime_current_time_seconds", sh_curtime, "*",
            "informix_uptime_boot_time_seconds", sh_boottime, "*",
            "informix_uptime_pfclrtime_seconds", sh_pfclrtime, "*"
          FROM
            sysshmvals